<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="./css/index.css">
    <style>
        * {
            margin: 0;
            padding: 0
        }
        ul {
            list-style: none;
        }
        .tab {
            width: 600px;
            height: auto;
            margin: 100px auto;
            box-shadow: 2px 10px 3px rgba(7,17,27,0.1)
        }
        .nav {
            width: 100%;
            display: flex;
            flex-direction: row;
            align-items: center;
            margin-bottom: 20px;
            position: relative;


        }
        .nav li {
            flex-grow: 1;
            color: #555555;
            text-align: center;
            height:40px;
            line-height: 40px;
            transition: all 1s ease;

        }
        .nav .li_focus {

            color: #fff;

        }
        .move {
            position: absolute;
            height: 50px;
            width:33.3%;
            background-color: powderblue;
            z-index: -1;
            top:0;
            left: 0;
            transition: all 1s ease;
            border-radius: 5px;

        }

        li.li_focus:nth-child(1) ~ .move {
            transform: translate(0,0);
        }
        li.li_focus:nth-child(2) ~ .move {
            transform: translate(100%,0);
        }
        li.li_focus:nth-child(3) ~ .move {
            transform: translate(200%,0);
        }

        list {

        }

        .list li {
            height: 50px;
            line-height: 50px;
            color: #555;
            padding-left: 60px;
            box-sizing: border-box;
            position:relative;
        }
        .list li del {
            position: absolute;
            right: 15px;
            top: 10px;
            text-decoration: none;
            width: 20px;
            height: 20px;
            line-height: 16px;
            background-color: #eee;
            border-radius: 50%;
            text-align: center;
            color: #8e908c;
        }
        .list li:after {
            position:absolute;
            content: '';
            width: 90%;
            height:1px;
            background-color: #eee;
            bottom: 0;
            left: 20px;
        }
        .list li:before {
            content: "\e668";
            font-family: 'iconfont';
            position:absolute;
            left:10px;
            top: 0px;
            font-size: 26px;
            color: powderblue;
        }
        .tab  .list_focus:before {
            content: "\e63b";
            font-family: 'iconfont';
            position:absolute;
            left:10px;
            top: 0px;
            font-size: 26px;
            color: powderblue;
        }
        form {
            width: 300px;
            height: 30px;
            margin: 50px auto
        }
        form input[type=text] {
            height: 30px;
            width: 200px;
            outline:none;
            border-radius: 10px;
            border: 1px solid #333;
            padding-left:10px;
        }
        button {
            height: 30px;
            width: 50px;
            background-color: #d8505c;
            color: #fff;
            border-radius: 10px;
        }



    </style>
</head>
<body>
<form action="">
    <input type="text" placeholder="请输入今日任务" required>
    <button  type="submit" name="sub">提交</button>
</form>
<div class="tab">
    <ul class="nav">
        <li class="li_focus" type = 'all'>全部</li>
        <li type="done">完成</li>
        <li type = 'doing'>未完成</li>
        <li class="move"></li>
    </ul>
    <ul class="list">

    </ul>
</div>

<script>
    let oli = document.querySelectorAll('.nav >li')
    let prev = 0
    let type = 'all'
    oli.forEach( (item,index) => {
        item.onclick = function() {
            oli[prev].classList.remove('li_focus')
            this.classList.add('li_focus')
            prev =index

        }
    })
    let ooList = document.querySelector(".list")



    let todoList = [
        {id:0, content: '任mimi的幸福生活,任小懒猪',status: true},
        {id:1, content: '姚ranran,', status: false},
        {id:2, content: 'oracle? oracle!!!', status: false},


    ]
       if(!localStorage.getItem('todoList')) {

           setSave()
           todoList = JSON.parse(localStorage.getItem('todoList'))
           filterList(todoList)

       }else {
           filterList(JSON.parse(localStorage.getItem('todoList')))
       }

        function  setSave() {
           console.log(1);
           localStorage.setItem('todoList',JSON.stringify(todoList))
        }


    // ooList.addEventListener("mouseenter", function () {
    //     let oList = document.querySelectorAll('.list>li')
    //
    //     console.log(1);
    //
    //     for (let i = 0; i < oList.length; i++) {
    //         console.log(oList);
    //         oList[i].addEventListener('click', function () {
    //             console.log(2);
    //             for (let j = 0; j < oList.length; j++) {
    //                 oList[j].id = j
    //             }
    //             todoList.forEach(item => {
    //                 if (item.id == this.id) {
    //                     item.status = !item.status
    //                 }
    //             })
    //
    //
    //             this.classList.toggle("list_focus")
    //             filterList(showDiff(type))
    //         })
    //     }
    //
    //
    // })

    ooList.addEventListener("click", function (e) {
         let target = e.target
        if(target.nodeName === 'LI') {
                 console.log("LI");
            todoList.forEach(item => {
                if (item.id == target.id) {
                    item.status = !item.status
                }
            })
            target.classList.toggle("list_focus")
            filterList(showDiff(type))
            setSave()

        }

    })
    ooList.addEventListener('click', function(e) {
           let target = e.target
            if(target.nodeName === 'DEL') {
                console.dir("1"+todoList);
                todoList = todoList.filter( (item) => {
                     console.log(item);
                     return item.id != target.parentNode.id
                })
                console.dir("2"+todoList);
                filterList(showDiff(type))
                setSave()
            }
    })
    //添加

    let forms = document.forms[0]
    let  input = forms.elements[0]
    let  sub = forms.elements[1]

    sub.addEventListener("click", function (e) {
         e.preventDefault()

         let obj ={}
            obj = getobj()
            todoList.push(obj)
        filterList(showDiff(type))
        setSave()
         forms.reset()

    })

       function getobj() {
           let content = input.value;
          // console.log(val);
           let id = (todoList.length-1)+1
           console.log(id);
           let status = false
           return {id,content,status}
       }





  function  showDiff(type) {
        let arr = []
        switch (type) {
            case 'all':
                arr = todoList
                break;

            case 'done' :
                arr = todoList.filter((item) => {
                    return item.status
                })
                break;

            case 'doing' :
                arr = todoList.filter((item) => {
                    return !item.status
                })
                break;

        }
      filterList(arr)
      return arr
    }


    for (let i = 0; i < todoList.length; i++) {
        oli[i].addEventListener('click', function () {
            type = oli[i].getAttribute('type')
            showDiff(type)

        })

    }



    function  filterList(arr) {
          let html = ''
        for(let i = 0; i <arr.length; i++) {
            if(!arr[i].status) {
                html += ` <li  id=${arr[i].id}>${arr[i].content} <del>x</del></li>`
            }else {
                html +=`<li class="list_focus" id=${arr[i].id}>${arr[i].content}<del>x</del></li>`
            }
        }
        ooList.innerHTML = html


    }

</script>
</body>
</html>